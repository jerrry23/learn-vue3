{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/reactive.ts"],
  "sourcesContent": ["/*\r\n * @Author: jerrry23 dixiqi@163.com\r\n * @Date: 2022-06-15 20:54:03\r\n * @LastEditors: jerrry23 dixiqi@163.com\r\n * @LastEditTime: 2022-06-15 20:57:05\r\n * @FilePath: \\learn-vue3\\3.reactivity\\packages\\reactivity\\src\\index.ts\r\n * @Description: \u8FD9\u662F\u9ED8\u8BA4\u8BBE\u7F6E,\u8BF7\u8BBE\u7F6E`customMade`, \u6253\u5F00koroFileHeader\u67E5\u770B\u914D\u7F6E \u8FDB\u884C\u8BBE\u7F6E: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\nexport {effect} from './effect';\r\nexport {reactive} from './reactive';", "/*\r\n * @Author: jerrry23 dixiqi@163.com\r\n * @Date: 2022-06-15 20:55:45\r\n * @LastEditors: jerrry23 dixiqi@163.com\r\n * @LastEditTime: 2022-06-15 23:48:41\r\n * @FilePath: \\learn-vue3\\3.reactivity\\packages\\reactivity\\src\\effect.ts\r\n * @Description: \u8FD9\u662F\u9ED8\u8BA4\u8BBE\u7F6E,\u8BF7\u8BBE\u7F6E`customMade`, \u6253\u5F00koroFileHeader\u67E5\u770B\u914D\u7F6E \u8FDB\u884C\u8BBE\u7F6E: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\n\r\n// \u4F20\u5165\u7684\u5FC5\u987B\u662F\u4E00\u4E2A\u5BF9\u8C61 \uFF0C\u5426\u5219\u5C31\u63D0\u793A\r\n\r\n\r\nexport let activeEffect = undefined;\r\n// \u4F9D\u8D56\u6536\u96C6\u7684\u539F\u7406\u662F \u501F\u52A9js\u662F\u5355\u7EBF\u7A0B\u7684\u7279\u70B9\uFF0C \u9ED8\u8BA4\u8C03\u7528effect\u7684\u65F6\u5019\u4F1A\u53BB\u8C03\u7528proxy\u7684get\uFF0C\u6B64\u65F6\u8BA9\u5C5E\u6027\u8BB0\u4F4F\r\n\r\nexport function effect(fn, options = {} as any) {\r\n\r\n    // \u5C06\u7528\u6237\u4F20\u9012\u7684\u51FD\u6570\u7F16\u7A0B\u54CD\u5E94\u5F0F\u7684effect\r\n    const _effect = new ReactiveEffect(fn);\r\n    \r\n    _effect.run()\r\n  \r\n    \r\n}\r\n\r\nexport class ReactiveEffect {\r\n    public active = true;\r\n    public parent = null;\r\n    public deps = []; // effect\u4E2D\u7528\u4E86\u54EA\u4E9B\u5C5E\u6027\uFF0C\u540E\u7EED\u6E05\u7406\u7684\u65F6\u5019\u8981\u4F7F\u7528\r\n    constructor(public fn,public scheduler?) { } // \u4F60\u4F20\u9012\u7684fn\u6211\u4F1A\u5E2E\u4F60\u653E\u5230this\u4E0A\r\n    // effectScope \u53EF\u4EE5\u6765\u5B9E\u73B0\u8BA9\u6240\u6709\u7684effect\u505C\u6B62\r\n    run() {\r\n        // \u4F9D\u8D56\u6536\u96C6  \u8BA9\u719F\u6089\u548Ceffect \u4EA7\u751F\u5173\u8054\r\n        \r\n            try {\r\n                this.parent = activeEffect\r\n                activeEffect = this;\r\n                cleanEffect(this); // vue2 \u548C vue3\u4E2D\u90FD\u662F\u8981\u6E05\u7406\u7684 \r\n                return this.fn(); // \u53BBproxy\u5BF9\u8C61\u4E0A\u53D6\u503C, \u53D6\u4E4B\u7684\u65F6\u5019 \u6211\u8981\u8BA9\u8FD9\u4E2A\u719F\u6089 \u548C\u5F53\u524D\u7684effect\u51FD\u6570\u5173\u8054\u8D77\u6765\uFF0C\u7A0D\u540E\u6570\u636E\u53D8\u5316\u4E86 \uFF0C\u53EF\u4EE5\u91CD\u65B0\u6267\u884Ceffect\u51FD\u6570\r\n            } finally {\r\n                // \u53D6\u6D88\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684effect\r\n                activeEffect = this.parent;\r\n                this.parent = null;\r\n            }\r\n        this.fn()\r\n    }\r\n    stop() {\r\n        if (this.active) {\r\n            this.active = false;\r\n            cleanEffect(this);\r\n        }\r\n    }\r\n}", "export const isObject = (value) =>{\n    return typeof value === 'object' && value !== null\n}\nexport const isFunction= (value) =>{\n    return typeof value === 'function'\n}", "/*\r\n * @Author: jerrry23 dixiqi@163.com\r\n * @Date: 2022-06-15 20:54:14\r\n * @LastEditors: jerrry23 dixiqi@163.com\r\n * @LastEditTime: 2022-06-15 22:17:41\r\n * @FilePath: \\learn-vue3\\3.reactivity\\packages\\reactivity\\src\\reactive.ts\r\n * @Description: \u8FD9\u662F\u9ED8\u8BA4\u8BBE\u7F6E,\u8BF7\u8BBE\u7F6E`customMade`, \u6253\u5F00koroFileHeader\u67E5\u770B\u914D\u7F6E \u8FDB\u884C\u8BBE\u7F6E: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\nexport const enum ReactiveFlags {\r\n    IS_REACTIVE = '__v_isReactive'\r\n}\r\nimport { isObject } from \"@vue/shared\";\r\nconst reactiveMap = new WeakMap();// key\u5FC5\u987B\u662F\u5BF9\u8C61\uFF0C\u5F31\u5F15\u7528\r\nexport function reactive(target){\r\n\r\n    if(!isObject(target)) {\r\n        // \u53EA\u80FD\u64CD\u4F5C\u5BF9\u8C61 \r\n        return false ;\r\n    }\r\n   \r\n    if(target[ReactiveFlags.IS_REACTIVE]) {  // \u8FD9\u91CC\u6267\u884C\u7684\u65F6\u5019\uFF0C\u8FD8\u662F\u4F1A\u8D70 proxy\u7684\u9053\u7406\u65B9\u6CD5 \r\n        // \u4F20\u5165\u7684\u662F\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61 proxy  \r\n        return  target\r\n    }\r\n    const existing = reactiveMap.get(target);\r\n    console.log(existing)\r\n    if(existing){\r\n        console.log(\"===============\")\r\n        return existing\r\n    }\r\n    // \u8FDB\u884C\u4EE3\u7406  \u5E76\u8FD4\u56DE\u4EE3\u7406\u540E\u7684\u6570\u636E \r\n    const  proxy =  new Proxy(target,{\r\n        get(target,key ,receiver) {\r\n            console.log(\"\u4EE3\u7406key:\" , key ,  \"\u4EE3\u7406\u7684\u5BF9\u8C61\u662F\uFF1A\" + target)\r\n            if(key === ReactiveFlags.IS_REACTIVE){\r\n                return true\r\n            }\r\n            return Reflect.get(target,key,receiver)\r\n        },\r\n\r\n        set(target,key ,value,receiver) {\r\n            console.log(\"\u8BBE\u7F6Ekey :\"  ,key  ,\"\u4EE3\u7406\u7684\u5BF9\u8C61\u662F\uFF1A\" +target)\r\n            target[key] = value\r\n            return Reflect.set(target,key ,value,receiver)\r\n        } \r\n    })\r\n    reactiveMap.set(target,proxy)\r\n    return proxy;\r\n}\r\n\r\n\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACYO,MAAI,eAAe;AAGnB,kBAAgB,IAAI,UAAU,CAAC,GAAU;AAG5C,UAAM,UAAU,IAAI,eAAe,EAAE;AAErC,YAAQ,IAAI;AAAA,EAGhB;AAEO,MAAM,iBAAN,MAAqB;AAAA,IAIxB,YAAmB,IAAU,WAAY;AAAtB;AAAU;AAH7B,WAAO,SAAS;AAChB,WAAO,SAAS;AAChB,WAAO,OAAO,CAAC;AAAA,IAC4B;AAAA,IAE3C,MAAM;AAGE,UAAI;AACA,aAAK,SAAS;AACd,uBAAe;AACf,oBAAY,IAAI;AAChB,eAAO,KAAK,GAAG;AAAA,MACnB,UAAE;AAEE,uBAAe,KAAK;AACpB,aAAK,SAAS;AAAA,MAClB;AACJ,WAAK,GAAG;AAAA,IACZ;AAAA,IACA,OAAO;AACH,UAAI,KAAK,QAAQ;AACb,aAAK,SAAS;AACd,oBAAY,IAAI;AAAA,MACpB;AAAA,IACJ;AAAA,EACJ;;;ACpDO,MAAM,WAAW,CAAC,UAAS;AAC9B,WAAO,OAAO,UAAU,YAAY,UAAU;AAAA,EAClD;;;ACUA,MAAM,cAAc,oBAAI,QAAQ;AACzB,oBAAkB,QAAO;AAE5B,QAAG,CAAC,SAAS,MAAM,GAAG;AAElB,aAAO;AAAA,IACX;AAEA,QAAG,OAAO,qCAA4B;AAElC,aAAQ;AAAA,IACZ;AACA,UAAM,WAAW,YAAY,IAAI,MAAM;AACvC,YAAQ,IAAI,QAAQ;AACpB,QAAG,UAAS;AACR,cAAQ,IAAI,iBAAiB;AAC7B,aAAO;AAAA,IACX;AAEA,UAAO,QAAS,IAAI,MAAM,QAAO;AAAA,MAC7B,IAAI,SAAO,KAAK,UAAU;AACtB,gBAAQ,IAAI,oBAAW,KAAO,+CAAY,OAAM;AAChD,YAAG,QAAQ,oCAA0B;AACjC,iBAAO;AAAA,QACX;AACA,eAAO,QAAQ,IAAI,SAAO,KAAI,QAAQ;AAAA,MAC1C;AAAA,MAEA,IAAI,SAAO,KAAK,OAAM,UAAU;AAC5B,gBAAQ,IAAI,qBAAY,KAAM,+CAAW,OAAM;AAC/C,gBAAO,OAAO;AACd,eAAO,QAAQ,IAAI,SAAO,KAAK,OAAM,QAAQ;AAAA,MACjD;AAAA,IACJ,CAAC;AACD,gBAAY,IAAI,QAAO,KAAK;AAC5B,WAAO;AAAA,EACX;",
  "names": []
}
